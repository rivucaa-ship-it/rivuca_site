<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RIVUCA — Demo D · Asistente privado</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --brand:#0b2545;
      --card:#f8fafc;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:920px;margin:0 auto;padding:28px}
    .top{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand{font-weight:800;letter-spacing:.4px}
    .pill{border:1px solid var(--line); padding:8px 12px;border-radius:999px;color:var(--muted);font-size:14px}
    .card{margin-top:18px;background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:18px}
    h1{margin:0;font-size:26px}
    p{margin:8px 0;color:var(--muted)}
    .chat{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:#fff;
      overflow:hidden;
    }
    .msgs{padding:14px; height:360px; overflow:auto; display:flex; flex-direction:column; gap:10px}
    .msg{max-width:78%; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background:#fff}
    .me{align-self:flex-end; background:#f1f5f9}
    .bot{align-self:flex-start}
    .meta{font-size:12px;color:var(--muted);margin-top:6px}
    .bar{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line);background:#fff}
    input{flex:1;padding:12px 12px;border-radius:12px;border:1px solid var(--line);font:inherit}
    button{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
    button:hover{opacity:.92}
    .hint{font-size:13px;color:var(--muted)}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{border:1px solid var(--line);background:#fff;border-radius:999px;padding:7px 10px;font-size:13px;color:var(--muted);cursor:pointer}
    .chip:hover{background:#f1f5f9}
    .foot{margin-top:10px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">RIVUCA</div>
      <div class="pill">Demo D · Asistente privado</div>
    </div>

    <div class="card">
      <h1>Asistente privado con tus documentos</h1>
      <p>
        Demo local: el asistente responde usando <b>solo</b> una base de conocimiento interna (FAQs/políticas).
      </p>

      <div class="chips">
        <div class="chip" data-q="¿Cuál es el horario de atención?">Horario</div>
        <div class="chip" data-q="¿Cómo hago la matrícula?">Matrícula</div>
        <div class="chip" data-q="¿Puedo pedir una clase de prueba?">Clase de prueba</div>
        <div class="chip" data-q="¿Qué cursos tenéis y niveles?">Cursos</div>
        <div class="chip" data-q="¿Cómo se paga y puedo pedir factura?">Pagos</div>
        <div class="chip" data-q="¿Cuál es la política de cancelaciones?">Cancelaciones</div>
      </div>


      <div class="chat" role="region" aria-label="Chat demo">
        <div class="msgs" id="msgs">
          <div class="msg bot">
            Hola. Soy un asistente privado de demostración. Pregúntame por horarios, reservas, menú, pagos o alergias.
            <div class="meta">Fuente: base interna (kb.json)</div>
          </div>
        </div>
        <div class="bar">
          <input id="inp" placeholder="Escribe tu pregunta…" />
          <button id="send">Enviar</button>
        </div>
      </div>

      <div class="foot">
        Nota: en proyectos reales se conecta a tus PDFs y procedimientos. Si hay documentos escaneados, se añade OCR.
      </div>
    </div>
  </div>

<script>
  const msgs = document.getElementById("msgs");
  const inp = document.getElementById("inp");
  const send = document.getElementById("send");

  let KB = [];

  function add(text, who="bot", source=null){
    const d = document.createElement("div");
    d.className = "msg " + (who === "me" ? "me" : "bot");
    d.textContent = text;
    if(source){
      const m = document.createElement("div");
      m.className = "meta";
      m.textContent = "Fuente: " + source;
      d.appendChild(m);
    }
    msgs.appendChild(d);
    msgs.scrollTop = msgs.scrollHeight;
  }

  function norm(s){
    return (s || "")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .replace(/[^\w\s]/g," ")
      .replace(/\s+/g," ")
      .trim();
  }

  function score(query, item){
    // scoring simple: tags + palabras del título
    const q = norm(query).split(" ").filter(Boolean);
    const tags = (item.tags || []).map(norm);
    const title = norm(item.title || "");

    let sc = 0;
    for(const w of q){
      if(title.includes(w)) sc += 2;
      for(const t of tags){
        if(t.includes(w)) sc += 3;
      }
    }
    return sc;
  }

  function answer(query){
    const ranked = KB
      .map(it => ({it, sc: score(query, it)}))
      .sort((a,b) => b.sc - a.sc);

    if(!ranked.length || ranked[0].sc === 0){
      return {
        text: "No encuentro esa información en la base interna de la demo. Si me das tus documentos (PDFs/políticas), puedo enseñarte cómo quedaría.",
        source: "kb.json"
      };
    }
    const best = ranked[0].it;
    return { text: best.answer, source: best.title };
  }

  async function loadKB(){
    const res = await fetch("kb.json");
    KB = await res.json();
  }

  function sendMsg(){
    const q = inp.value.trim();
    if(!q) return;
    add(q, "me");
    const a = answer(q);
    add(a.text, "bot", a.source);
    inp.value = "";
    inp.focus();
  }

  send.addEventListener("click", sendMsg);
  inp.addEventListener("keydown", (e) => {
    if(e.key === "Enter") sendMsg();
  });

  document.querySelectorAll(".chip").forEach(ch => {
    ch.addEventListener("click", () => {
      inp.value = ch.dataset.q;
      sendMsg();
    });
  });

  loadKB();
</script>
</body>
</html>

